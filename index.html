<!DOCTYPE html>
<html lang="en">
<head>
<title>Three Shooter</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta http-equiv="X-UA-Compatible" content="IE=11" />

<style>
    body {
        margin: 0px;
        background-color: #222222;
        overflow: hidden;
        color: #FFFFFF;
        font-family: monospace;
        font-size: 11px;
    }
    #interface{
        position: absolute;
        left:10px;
        top:10px;
        width:600px;
        height:20px;
    }
    #info{
        pointer-events:none;
        position: absolute;
        left:10px;
        top:60px;
        width:300px;
        height:200px;
    }
</style>

<script src="js/three.js"></script>
<script src="js/Shooter.js"></script>

</head>
<body>
<div id='container'></div>
<div id='interface'>
    <input type="button" value="PLAY" onClick=Game.initLevel()>
</div>
<div id='info'>Yoo</div>
</body>   
<script type="text/javascript">

var camera, scene, sceneback, renderer, container, center, projector, content;
var info = document.getElementById("info");

var Game;
var Deep = 0;
var fps=0, time, time_prev=0, fpsint = 0;
var timer, delay, timerStep, t01, ms =0 , maxms = 0;

init();
loop();

function init() {
    renderer = new THREE.WebGLRenderer({precision: "mediump", antialias:false});
    renderer.setSize( window.innerWidth, window.innerHeight-100 );
    renderer.autoClearColor = false;
    renderer.gammaInput = true;
    renderer.gammaOutput = true;

    renderer.domElement.style.position = "absolute";
    renderer.domElement.style.top = 50 + "px";
    renderer.domElement.style.left = "0px";

    container = document.getElementById("container");
    container.appendChild( renderer.domElement );

    sceneback = new THREE.Scene();
    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera( 30, window.innerWidth / (window.innerHeight-100), 1, 20000 );
    center = new THREE.Vector3();
    camera.position.z = -4000;
    camera.lookAt(center);

    var vFOV = camera.fov * Math.PI / 180;
    Deep = -(2 * Math.tan( vFOV / 2 ) * camera.position.z).toFixed(2);

    Game = new SHOOTER.Game( showInfo, scene, sceneback );
    Game.init();

    window.addEventListener( 'resize', resize, false );
    container.addEventListener( 'mousedown', onMouseDown, false );
    container.addEventListener( 'mousemove', onMouseMove, false );
    container.addEventListener( 'mouseup', onMouseUp, false );
    resize();
    setInterval(gameLoop, 1000/60 );
}

function onMouseDown(e) {
    Game.onShoot=true;
}
function onMouseUp(e) {
    Game.onShoot=false;
}
function onMouseMove(e) {
    var x = -(e.clientX - ( window.innerWidth  *0.5))  ;
    var y = -(e.clientY - (50+(window.innerHeight-100) *0.5)) ;
    Game.moveShip(x,y);
}

function gameLoop() {
    Game.update();
}

function loop() {
    requestAnimationFrame( loop );

    t01 = Date.now();

    renderer.render( sceneback, camera )
    renderer.render( scene, camera );

    time = Date.now();
    ms = time - t01;
    if(ms > maxms)maxms = ms;
    if (time - 1000 > time_prev) {
        time_prev = time; fpsint = fps; fps = 0;maxms=0;
    } fps++;
}

function resize() {
    renderer.setSize( window.innerWidth, window.innerHeight-100 );
    camera.aspect = window.innerWidth / (window.innerHeight-100);
    camera.updateProjectionMatrix();
    Game.resize(window.innerWidth, window.innerHeight-100, ((window.innerHeight-100) / Deep).toFixed(2));
}

function showInfo( txt ){
    info.innerHTML = fpsint +" fps " +  ms+"/"+maxms + " ms<br><br>"+ txt;
}

</script>
</html>