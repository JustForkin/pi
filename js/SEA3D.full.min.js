var SEA3D={VERSION:16002,REVISION:2},LZMA;SEA3D.Timer=function(){this.time=this.start=this.getTime()},SEA3D.Timer.prototype.getDeltaTime=function(){return this.getTime()-this.time},SEA3D.Timer.prototype.getTime=function(){return+new Date},SEA3D.Timer.prototype.getElapsedTime=function(){return this.getTime()-this.start},SEA3D.Timer.prototype.update=function(){this.time=this.getTime()},SEA3D.Stream=function(n){this.position=0,this.set(n||new Uint8Array)},SEA3D.Stream.prototype.TWOeN23=Math.pow(2,-23),SEA3D.Stream.prototype.TWOeN52=Math.pow(2,-52),SEA3D.Stream.prototype.pow=Math.pow,SEA3D.Stream.prototype.set=function(n){this.buffer=n,this.length=n.length},SEA3D.Stream.prototype.readByte=function(){return this.buffer[this.position++]},SEA3D.Stream.prototype.readBytes=function(n){for(var i=new Uint8Array(n),t=0;t<n;++t)i[t]=this.buffer[this.position++];return i},SEA3D.Stream.prototype.readBool=function(){return this.readByte()!=0},SEA3D.Stream.prototype.readUShort=function(){return this.readByte()|this.readByte()<<8},SEA3D.Stream.prototype.readUInt24=function(){return this.readByte()|this.readByte()<<8|this.readByte()<<16},SEA3D.Stream.prototype.readUInt=function(){return this.readByte()|this.readByte()<<8|this.readByte()<<16|this.readByte()<<24},SEA3D.Stream.prototype.readFloat=function(){var u=this.readByte(),f=this.readByte(),n=this.readByte(),t=this.readByte(),e=1-(t>>7<<1),i=(t<<1&255|n>>7)-127,r=(n&127)<<16|f<<8|u;return r==0&&i==-127?0:e*(1+this.TWOeN23*r)*this.pow(2,i)},SEA3D.Stream.prototype.readVector2=function(){return{x:this.readFloat(),y:this.readFloat()}},SEA3D.Stream.prototype.readVector3=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat()}},SEA3D.Stream.prototype.readVector4=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat(),w:this.readFloat()}},SEA3D.Stream.prototype.readMatrix=function(){var n=new Float32Array(16);return n[0]=this.readFloat(),n[1]=this.readFloat(),n[2]=this.readFloat(),n[3]=0,n[4]=this.readFloat(),n[5]=this.readFloat(),n[6]=this.readFloat(),n[7]=0,n[8]=this.readFloat(),n[9]=this.readFloat(),n[10]=this.readFloat(),n[11]=0,n[12]=this.readFloat(),n[13]=this.readFloat(),n[14]=this.readFloat(),n[15]=1,n},SEA3D.Stream.prototype.readString=function(n){return String.fromCharCode.apply(null,new Uint16Array(this.readBytes(n)))},SEA3D.Stream.prototype.readExt=function(){return this.readString(4).replace("\0","")},SEA3D.Stream.prototype.readStringTiny=function(){return this.readString(this.readByte())},SEA3D.Stream.prototype.readBlendMode=function(){return SEA3D.DataTable.BLEND_MODE[this.readByte()]},SEA3D.Stream.prototype.readAnimationList=function(n){for(var r=[],f=this.readByte(),u=0,i,t;u<f;)i=this.readByte(),t={},t.relative=(i&1)!=0,i&2&&(t.timeScale=this.readFloat()),t.tag=n.getObject(this.readUInt()),r[u++]=t;return r},SEA3D.Stream.prototype.readScriptList=function(n){for(var f=[],u=this.readByte(),t=0,r,i,e;t<u;){if(r=this.readByte(),i={},i.priority=r&1|r&2,r&4)for(i.params=[],u=this.readByte(),t=0;t<u;t++)e=this.readString(),i.params[e]=SEA3D.DataTable.readObject(this);i.tag=n.getObject(this.readUInt()),f[t++]=anm}return f},SEA3D.Stream.prototype.append=function(n){var t=new Uint8Array(this.data.byteLength+n.byteLength);t.set(new Uint8Array(this.data),0),t.set(new Uint8Array(n),this.data.byteLength),this.data=t},SEA3D.Stream.prototype.concat=function(n,t){return new SEA3D.Stream(this.buffer.subarray(n,n+t))},SEA3D.Stream.prototype.bytesAvailable=function(){return this.length-this.position},SEA3D.DataTable={NONE:0,BOOLEAN:1,BYTE:2,UBYTE:3,SHORT:4,USHORT:5,INT24:6,UINT24:7,INT:8,UINT:9,FLOAT:10,DOUBLE:11,DECIMAL:12,VECTOR3D:74,VECTOR4D:106,STRING_TINY:128,STRING_SHORT:129,STRING_LONG:130},SEA3D.DataTable.BLEND_MODE=["normal","add","subtract","multiply","dividing","alpha","screen","darken","overlay","colorburn","linearburn","lighten","colordodge","lineardodge","softlight","hardlight","pinlight","spotlight","spotlightblend","hardmix","average","difference","exclusion","hue","saturation","color","value"],SEA3D.DataTable.INTERPOLATION_TABLE=["normal","linear","sine.in","sine.out","sine.inout","cubic.in","cubic.out","cubic.inout","quint.in","quint.out","quint.inout","circ.in","circ.out","circ.inout","back.in","back.out","back.inout","quad.in","quad.out","quad.inout","quart.in","quart.out","quart.inout","expo.in","expo.out","expo.inout","elastic.in","elastic.out","elastic.inout","bounce.in","bounce.out","bounce.inout"],SEA3D.DataTable.readObject=function(n){SEA3D.DataTable.readToken(n.readByte(),n)},SEA3D.DataTable.readToken=function(n,t){switch(n){case SEA3D.DataTable.BOOLEAN:return t.readBool();case SEA3D.DataTable.UBYTE:return t.readByte();case SEA3D.DataTable.USHORT:return t.readUShort();case SEA3D.DataTable.UINT24:return t.readUInt24();case SEA3D.DataTable.UINT:return t.readUInt();case SEA3D.DataTable.FLOAT:return t.readFloat();case SEA3D.DataTable.VECTOR3D:return t.readVector3();case SEA3D.DataTable.VECTOR4D:return t.readVector4();case SEA3D.DataTable.STRING_TINY:return t.readString()}return null},SEA3D.DataTable.readVector=function(n,t,i,r,u){var o=SEA3D.DataTable.sizeOf(n),f=u*o,e=f+r*o;switch(n){case SEA3D.DataTable.BOOLEAN:while(f<e)i[f++]=t.readBool()?1:0;break;case SEA3D.DataTable.UBYTE:while(f<e)i[f++]=t.readByte();break;case SEA3D.DataTable.USHORT:while(f<e)i[f++]=t.readUShort();break;case SEA3D.DataTable.UINT24:while(f<e)i[f++]=t.readUInt24();break;case SEA3D.DataTable.UINT:while(f<e)i[f++]=t.readUInt();break;case SEA3D.DataTable.FLOAT:while(f<e)i[f++]=t.readFloat();break;case SEA3D.DataTable.VECTOR3D:while(f<e)i[f++]=t.readFloat(),i[f++]=t.readFloat(),i[f++]=t.readFloat();break;case SEA3D.DataTable.VECTOR4D:while(f<e)i[f++]=t.readFloat(),i[f++]=t.readFloat(),i[f++]=t.readFloat(),i[f++]=t.readFloat()}},SEA3D.DataTable.sizeOf=function(n){return n==0?0:n>=1&&n<=31?1:n>=32&&n<=63?2:n>=64&&n<=95?3:n>=96&&n<=125?4:-1},SEA3D.Math={DEGREES:180/Math.PI,RADIANS:Math.PI/180},SEA3D.Math.angle=function(n){var t=180,i=n<0;return n=(i?-n:n)%360,n>t&&(n=-t+(n-t)),i?-n:n},SEA3D.Math.lerpAngle=function(n,t,i){return Math.abs(n-t)>180&&(n>t?t+=360:t-=360),n+=(t-n)*i,SEA3D.Math.angle(n)},SEA3D.Math.lerpColor=function(n,t,i){var r=n>>24&255,u=n>>16&255,f=n>>8&255,e=n&255,o=t>>24&255,s=t>>16&255,h=t>>8&255,c=t&255;return r+=(o-r)*i,u+=(s-u)*i,f+=(h-f)*i,e+=(c-e)*i,r<<24|u<<16|f<<8|e},SEA3D.Math.lerp=function(n,t,i){return n+(t-n)*i},SEA3D.Math.lerp1x=function(n,t,i){n[0]+=(t[0]-n[0])*i},SEA3D.Math.lerp3x=function(n,t,i){n[0]+=(t[0]-n[0])*i,n[1]+=(t[1]-n[1])*i,n[2]+=(t[2]-n[2])*i},SEA3D.Math.lerpAng1x=function(n,t,i){n[0]=SEA3D.Math.lerpAngle(n[0],t[0],i)},SEA3D.Math.lerpColor1x=function(n,t,i){n[0]=SEA3D.Math.lerpColor(n[0],t[0],i)},SEA3D.Math.lerpQuat4x=function(n,t,i){var a=n[0],v=n[1],y=n[2],p=n[3],u=t[0],f=t[1],e=t[2],o=t[3],s,h,c,l,r;a*u+v*f+y*e+p*o<0&&(u=-u,f=-f,e=-e,o=-o),s=a+i*(u-a),h=v+i*(f-v),c=y+i*(e-y),l=p+i*(o-p),r=1/Math.sqrt(l*l+s*s+h*h+c*c),n[0]=s*r,n[1]=h*r,n[2]=c*r,n[3]=l*r},SEA3D.AnimationFrame=function(){this.data=[0,0,0,0]},SEA3D.AnimationFrame.prototype.toVector=function(){return{x:this.data[0],y:this.data[1],z:this.data[2],w:this.data[3]}},SEA3D.AnimationFrame.prototype.toAngles=function(n){var i=this.data[0],t=this.data[1],r=this.data[2],f=this.data[3],u=2*(f*t-r*i);return u<-1?u=-1:u>1&&(u=1),{x:Math.atan2(2*(f*i+t*r),1-2*(i*i+t*t))*n,y:Math.asin(u)*n,z:Math.atan2(2*(f*r+i*t),1-2*(t*t+r*r))*n}},SEA3D.AnimationFrame.prototype.toEuler=function(){return this.toAngles(SEA3D.Math.DEGREES)},SEA3D.AnimationFrame.prototype.toRadians=function(){return this.toAngles(1)},SEA3D.AnimationFrame.prototype.setX=function(n){this.data[0]=n},SEA3D.AnimationFrame.prototype.getX=function(){return this.data[0]},SEA3D.AnimationFrame.prototype.setY=function(n){this.data[1]=n},SEA3D.AnimationFrame.prototype.getY=function(){return this.data[1]},SEA3D.AnimationFrame.prototype.setZ=function(n){this.data[2]=n},SEA3D.AnimationFrame.prototype.getZ=function(){return this.data[2]},SEA3D.AnimationFrame.prototype.setW=function(n){this.data[3]=n},SEA3D.AnimationFrame.prototype.getW=function(){return this.data[3]},SEA3D.AnimationData=function(n,t,i,r){this.kind=n,this.type=t,this.blockLength=SEA3D.DataTable.sizeOf(t),this.data=i,this.offset=r==undefined?0:r;switch(this.blockLength){case 1:this.getData=this.getData1x;break;case 2:this.getData=this.getData2x;break;case 3:this.getData=this.getData3x;break;case 4:this.getData=this.getData4x}},SEA3D.AnimationData.prototype.getData1x=function(n,t){n=this.offset+n*this.blockLength,t[0]=this.data[n]},SEA3D.AnimationData.prototype.getData2x=function(n,t){n=this.offset+n*this.blockLength,t[0]=this.data[n],t[1]=this.data[n+1]},SEA3D.AnimationData.prototype.getData3x=function(n,t){n=this.offset+n*this.blockLength,t[0]=this.data[n],t[1]=this.data[n+1],t[2]=this.data[n+2]},SEA3D.AnimationData.prototype.getData4x=function(n,t){n=this.offset+n*this.blockLength,t[0]=this.data[n],t[1]=this.data[n+1],t[2]=this.data[n+2],t[3]=this.data[n+3]},SEA3D.AnimationNode=function(n,t,i,r,u){this.name=n,this.frameRate=t,this.frameMill=1e3/t,this.numFrames=i,this.length=i-1,this.time=0,this.duration=this.length*this.frameMill,this.repeat=r,this.intrpl=u,this.invalidState=!0,this.dataList=[],this.dataListId={},this.buffer=new SEA3D.AnimationFrame,this.percent=0,this.prevFrame=0,this.nextFrame=0,this.frame=0},SEA3D.AnimationNode.prototype.setTime=function(n){this.frame=this.validFrame(n/this.frameMill),this.time=this.frame*this.frameRate,this.invalidState=!0},SEA3D.AnimationNode.prototype.getTime=function(){return this.time},SEA3D.AnimationNode.prototype.setFrame=function(n){this.setTime(n*this.frameMill)},SEA3D.AnimationNode.prototype.getRealFrame=function(){return Math.floor(this.frame)},SEA3D.AnimationNode.prototype.getFrame=function(){return this.frame},SEA3D.AnimationNode.prototype.setPosition=function(n){this.setFrame(n*this.numFrames)},SEA3D.AnimationNode.prototype.getPosition=function(){return this.frame*this.numFrames},SEA3D.AnimationNode.prototype.validFrame=function(n){var t=n<0;return t&&(n=-n),n>this.length&&(n=this.repeat?n%this.length:this.length),t&&(n=this.length-n),n},SEA3D.AnimationNode.prototype.addData=function(n){this.dataListId[n.kind]=n,this.dataList[this.dataList.length]=n},SEA3D.AnimationNode.prototype.removeData=function(n){delete this.dataListId[n.kind],this.dataList.splice(this.dataList.indexOf(n),1)},SEA3D.AnimationNode.prototype.getDataByKind=function(n){return this.dataListId[n]},SEA3D.AnimationNode.prototype.getFrameAt=function(n,t){return this.dataListId[t].getFrameData(n,buffer.data),buffer},SEA3D.AnimationNode.prototype.getFrame=function(n){return this.dataListId[n].getFrameData(this.getRealFrame(),buffer.data),buffer},SEA3D.AnimationNode.prototype.getInterpolationFrame=function(n,t){return this.numFrames==0?this.buffer:(this.invalidState&&(this.prevFrame=this.getRealFrame(),this.nextFrame=this.validFrame(this.prevFrame+1),this.percent=this.frame-this.prevFrame,this.invalidState=!1),n.getData(this.prevFrame,this.buffer.data),this.percent>0&&(n.getData(this.nextFrame,SEA3D.AnimationNode.FRAME_BUFFER),t(this.buffer.data,SEA3D.AnimationNode.FRAME_BUFFER,this.percent)),this.buffer)},SEA3D.AnimationNode.FRAME_BUFFER=[0,0,0,0],SEA3D.AnimationSet=function(){this.animations=[],this.dataCount=-1},SEA3D.AnimationSet.prototype.addAnimation=function(n){this.dataCount==-1&&(this.dataCount=n.dataList.length),this.animations[n.name]=n,this.animations.push(n)},SEA3D.AnimationSet.prototype.getAnimationByName=function(n){return this.animations[n]},SEA3D.AnimationState=function(n){this.node=n,this.offset=0,this.weight=0,this.time=0},SEA3D.AnimationState.prototype.setTime=function(n){this.node.time=this.time=n},SEA3D.AnimationState.prototype.getTime=function(){return this.time},SEA3D.AnimationState.prototype.setFrame=function(n){this.node.setFrame(n),this.time=this.node.time},SEA3D.AnimationState.prototype.getFrame=function(){return this.update(),this.node.getFrame()},SEA3D.AnimationState.prototype.setPosition=function(n){this.node.setPosition(n),this.time=this.node.time},SEA3D.AnimationState.prototype.getPosition=function(){return this.update(),this.node.getPosition()},SEA3D.AnimationState.prototype.update=function(){this.node.time!=this.time&&this.node.setTime(this.time)},SEA3D.AnimationHandler=function(n){this.animationSet=n,this.states=SEA3D.AnimationHandler.stateFromAnimations(n.animations),this.timeScale=1,this.time=0,this.numAnimation=n.animations.length,this.relative=!1,this.playing=!1},SEA3D.AnimationHandler.prototype.update=function(n){this.time+=n*this.timeScale,this.updateState(),this.updateAnimation()},SEA3D.AnimationHandler.prototype.updateState=function(){this.currentState.node.setTime(this.time)},SEA3D.AnimationHandler.prototype.updateAnimation=function(){for(var r=this.animationSet.dataCount,i=this.currentState.node,n=0;n<r;n++){var t=i.dataList[n],u=SEA3D.Animation.DefaultLerpFuncs[t.kind],f=i.getInterpolationFrame(t,u);this.updateAnimationFrame&&this.updateAnimationFrame(f,t.kind)}},SEA3D.AnimationHandler.prototype.getStateByName=function(n){return this.states[n]},SEA3D.AnimationHandler.prototype.getStateNameByIndex=function(n){return this.animationSet.animations[n].name},SEA3D.AnimationHandler.prototype.play=function(n){this.currentState=this.getStateByName(n),this.playing||(SEA3D.AnimationHandler.add(this),this.playing=!0)},SEA3D.AnimationHandler.prototype.pause=function(){this.playing&&(SEA3D.AnimationHandler.remove(this),this.playing=!1)},SEA3D.AnimationHandler.prototype.stop=function(){this.time=0,this.pause()},SEA3D.AnimationHandler.prototype.setRelative=function(n){this.relative=n},SEA3D.AnimationHandler.prototype.getRelative=function(){return this.relative},SEA3D.AnimationHandler.add=function(n){SEA3D.AnimationHandler.animations.push(n)},SEA3D.AnimationHandler.remove=function(n){SEA3D.AnimationHandler.animations.splice(SEA3D.AnimationHandler.animations.indexOf(n),1)},SEA3D.AnimationHandler.stateFromAnimations=function(n){for(var i=[],t=0;t<n.length;t++)i[n[t].name]=i[t]=new SEA3D.AnimationState(n[t]);return i},SEA3D.AnimationHandler.update=function(n){n*=1e3;for(var t in SEA3D.AnimationHandler.animations)SEA3D.AnimationHandler.animations[t].update(n)},SEA3D.AnimationHandler.setTime=function(n){for(var t in SEA3D.AnimationHandler.animations)SEA3D.AnimationHandler.animations[t].time=n},SEA3D.AnimationHandler.stop=function(){while(SEA3D.AnimationHandler.animations.length)SEA3D.AnimationHandler.animations[0].stop()},SEA3D.AnimationHandler.animations=[],SEA3D.Object=function(n,t,i,r){this.name=n,this.data=t,this.type=i,this.sea=r},SEA3D.GeometryBase=function(n){var t=n.data;n.attrib=t.readUShort(),n.isBigMesh=(n.attrib&1)!=0,t.readVInt=n.isBigMesh?t.readUInt:t.readUShort,n.numVertex=t.readVInt(),n.length=n.numVertex*3},SEA3D.Geometry=function(n,t,i){var r,u,f,e;if(this.name=n,this.data=t,this.sea=i,SEA3D.GeometryBase(this),this.attrib&4)for(this.normal=[],r=0;r<this.length;)this.normal[r++]=t.readFloat();if(this.attrib&8)for(this.tangent=[],r=0;r<this.length;)tangent[r++]=t.readFloat();if(this.attrib&32)for(this.uv=[],this.uv.length=t.readByte(),f=this.numVertex*2,r=0;r<this.uv.length;)for(this.uv[r++]=u=[],j=0;j<f;)u[j++]=t.readFloat();if(this.attrib&64){for(this.jointPerVertex=t.readByte(),e=this.numVertex*this.jointPerVertex,this.joint=[],this.weight=[],r=0;r<e;)this.joint[r++]=t.readUShort();for(r=0;r<e;)this.weight[r++]=t.readFloat()}if(this.attrib&128)for(this.color=[],r=0;r<this.length;)color[r++]=t.readByte()/255;for(this.vertex=[],r=0;r<this.length;)this.vertex[r++]=t.readFloat();for(this.indexes=[],this.indexes.length=t.readByte(),r=0;r<this.indexes.length;r++)for(f=t.readVInt()*3,this.indexes[r]=u=[],j=0;j<f;)u[j++]=t.readVInt()},SEA3D.Geometry.prototype.type="geo",SEA3D.Object3D={read:function(n){var t=n.data,i;n.isStatic=!1,n.attrib=t.readUShort(),n.tags=[],n.attrib&1&&(n.parent=n.sea.getObject(t.readUInt())),n.attrib&2&&(n.animations=t.readAnimationList(n.sea)),n.attrib&4&&(n.scripts=t.readScriptList(n.sea)),n.attrib&16&&(n.properties=n.sea.getObject(t.readUInt())),n.attrib&32&&(i=t.readByte(),n.isStatic=i&1)},readTags:function(n){for(var i=n.data,u=i.readByte(),r=0;r<u;++r){var o=i.readUShort(),f=i.readUInt(),e=i.position;i.position=e+=f}}},SEA3D.Entity3D={read:function(n){var t,i;SEA3D.Object3D.read(n),t=n.data,n.castShadows=!0,n.attrib&64&&(i=t.readByte(),castShadows=(i&1)==0)},readTags:function(n,t){SEA3D.Object3D.readTags(n,t)}},SEA3D.Mesh=function(n,t,i){var f,u,r;if(this.name=n,this.data=t,this.sea=i,SEA3D.Entity3D.read(this),this.attrib&256)if(this.material=[],u=t.readByte(),u==1)this.material[0]=i.getObject(t.readUInt());else for(r=0;r<u;)f=t.readUInt(),this.material[r++]=f>0?i.getObject(f-1):undefined;if(this.attrib&512)for(this.modifiers=[],u=t.readByte(),r=0;r<u;r++)this.modifiers[r]=i.getObject(t.readUInt());this.transform=t.readMatrix(),this.geometry=i.getObject(t.readUInt()),SEA3D.Entity3D.readTags(this)},SEA3D.Mesh.prototype.type="m3d",SEA3D.Skeleton=function(n,t,i){var u,r;for(this.name=n,this.data=t,this.sea=i,u=t.readUShort(),this.joint=[],r=0;r<u;r++)this.joint[r]={name:t.readStringTiny(),parentIndex:t.readUShort()-1,inverseBindMatrix:t.readMatrix()}},SEA3D.Skeleton.prototype.type="skl",SEA3D.SkeletonLocal=function(n,t,i){var u,r;for(this.name=n,this.data=t,this.sea=i,u=t.readUShort(),this.joint=[],r=0;r<u;r++)this.joint[r]={name:t.readStringTiny(),parentIndex:t.readUShort()-1,x:t.readFloat(),y:t.readFloat(),z:t.readFloat(),qx:t.readFloat(),qy:t.readFloat(),qz:t.readFloat(),qw:t.readFloat(),sx:t.readFloat(),sx:t.readFloat(),sx:t.readFloat()}},SEA3D.SkeletonLocal.prototype.type="sklq",SEA3D.AnimationBase={read:function(n){var t=n.data,r=t.readByte(),u,i;if(n.sequence=[],r&1)for(u=t.readUShort(),i=0;i<u;i++)r=t.readByte(),n.sequence[i]={name:t.readStringTiny(),start:t.readUInt(),count:t.readUInt(),repeat:(r&1)!=0,intrpl:(r&2)!=0};n.frameRate=t.readByte(),n.numFrames=t.readUInt(),n.sequence.length==0&&(n.sequence[0]={name:"root",start:0,count:n.numFrames,repeat:!0,intrpl:!0})}},SEA3D.Animation=function(n,t,i){var r;for(this.name=n,this.data=t,this.sea=i,SEA3D.AnimationBase.read(this),this.dataList=[],this.dataList.length=t.readByte(),r=0;r<this.dataList.length;r++){var e=t.readUShort(),u=t.readByte(),f=[];SEA3D.DataTable.readVector(u,t,f,this.numFrames,0),this.dataList[r]={kind:e,type:u,blockSize:SEA3D.DataTable.sizeOf(u),data:f}}},SEA3D.Animation.POSITION=0,SEA3D.Animation.ROTATION=1,SEA3D.Animation.SCALE=2,SEA3D.Animation.COLOR=3,SEA3D.Animation.MULTIPLIER=4,SEA3D.Animation.ATTENUATION_START=5,SEA3D.Animation.ATTENUATION_END=6,SEA3D.Animation.FOV=7,SEA3D.Animation.OFFSET_U=8,SEA3D.Animation.OFFSET_V=9,SEA3D.Animation.SCALE_U=10,SEA3D.Animation.SCALE_V=11,SEA3D.Animation.ANGLE=12,SEA3D.Animation.ALPHA=13,SEA3D.Animation.VOLUME=14,SEA3D.Animation.DefaultLerpFuncs=[SEA3D.Math.lerp3x,SEA3D.Math.lerpQuat4x,SEA3D.Math.lerp3x,SEA3D.Math.lerpColor1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerpAng1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x],SEA3D.Animation.prototype.type="anm",SEA3D.SkeletonAnimation=function(n,t,i){var e,r,u,f;for(this.name=n,this.data=t,this.sea=i,SEA3D.AnimationBase.read(this),e=t.readUShort(),this.pose=[],u=0;u<this.numFrames;u++){for(r=[],r.length=e,f=0;f<e;f++)r[f]={x:t.readFloat(),y:t.readFloat(),z:t.readFloat(),qx:t.readFloat(),qy:t.readFloat(),qz:t.readFloat(),qw:t.readFloat()};this.pose[u]=r}},SEA3D.SkeletonAnimation.prototype.type="skla",SEA3D.Morph=function(n,t,i){var r,n,u,f;this.name=n,this.data=t,this.sea=i,SEA3D.GeometryBase(this);var o=(this.attrib&2)!=0,s=(this.attrib&4)!=0,e=this.numVertex*3,h=t.readUShort();for(this.node=[],r=0;r<h;r++){if(n=t.readStringTiny(),o)for(u=[],j=0;j<e;)u[j++]=t.readFloat();if(s)for(f=[],j=0;j<e;)f[j++]=t.readFloat();this.node[r]={vertex:u,normal:f,name:n}}},SEA3D.Morph.prototype.type="mph",SEA3D.Camera=function(n,t,i){this.name=n,this.data=t,this.sea=i,SEA3D.Object3D.read(this),this.attrib&64&&(this.dof={distance:t.readFloat(),range:t.readFloat()}),this.transform=t.readMatrix(),this.fov=t.readFloat(),SEA3D.Object3D.readTags(this)},SEA3D.Camera.prototype.type="cam",SEA3D.JointObject=function(n,t,i){this.name=n,this.data=t,this.sea=i,SEA3D.Object3D.read(this),this.target=i.getObject(t.readUInt()),this.joint=t.readUShort(),this.transform=t.readMatrix(),this.fov=t.readFloat(),SEA3D.Object3D.readTags(this)},SEA3D.JointObject.prototype.type="jnt",SEA3D.Light={read:function(n){var t,i;SEA3D.Object3D.read(n),t=n.data,n.attenStart=Number.MAX_VALUE,n.attenEnd=Number.MAX_VALUE,n.attrib&64&&(i=t.readByte(),n.shadow={},n.shadow.opacity=i&1?t.readFloat():1,n.shadow.color=i&2?t.readUInt24():0),n.attrib&512&&(n.attenStart=t.readFloat(),n.attenEnd=t.readFloat()),n.color=t.readUInt24(),n.multiplier=t.readFloat()}},SEA3D.PointLight=function(n,t,i){this.name=n,this.data=t,this.sea=i,SEA3D.Light.read(this),this.attrib&128&&(this.attenuation={start:t.readFloat(),end:t.readFloat()}),this.position=t.readVector3(),SEA3D.Object3D.readTags(this)},SEA3D.PointLight.prototype.type="plht",SEA3D.DirectionalLight=function(n,t,i){this.name=n,this.data=t,this.sea=i,SEA3D.Light.read(this),this.transform=t.readMatrix(),SEA3D.Object3D.readTags(this)},SEA3D.DirectionalLight.prototype.type="dlht",SEA3D.Material=function(n,t,r){var e;for(this.name=n,this.data=t,this.sea=r,this.technique=[],this.attrib=t.readUShort(),this.alpha=1,this.blendMode="normal",this.alphaThreshold=.5,this.bothSides=(this.attrib&1)!=0,this.receiveLights=(this.attrib&2)==0,this.receiveShadows=(this.attrib&4)==0,this.receiveFog=(this.attrib&8)==0,this.smooth=(this.attrib&16)==0,this.attrib&32&&(this.alpha=t.readFloat()),this.attrib&64&&(this.blendMode=t.readBlendMode()),this.attrib&128&&(this.animations=t.readAnimationList(r)),e=t.readByte(),i=0;i<e;++i){var f=t.readUShort(),o=t.readUShort(),s=t.position,u;switch(f){case SEA3D.Material.DEFAULT:u={ambientColor:t.readUInt24(),diffuseColor:t.readUInt24(),specularColor:t.readUInt24(),specular:t.readFloat(),gloss:t.readFloat()};break;case SEA3D.Material.COMPOSITE_TEXTURE:u={composite:r.getObject(t.readUInt())};break;case SEA3D.Material.DIFFUSE_MAP:u={texture:r.getObject(t.readUInt())};break;case SEA3D.Material.SPECULAR_MAP:u={texture:r.getObject(t.readUInt())};break;case SEA3D.Material.NORMAL_MAP:u={texture:r.getObject(t.readUInt())};break;case SEA3D.Material.REFLECTION_MAP:case SEA3D.Material.FRESNEL_REFLECTION:u={texture:r.getObject(t.readUInt()),alpha:t.readFloat()},f==SEA3D.Material.FRESNEL_REFLECTION&&(u.power=t.readFloat(),u.normal=t.readFloat());break;case SEA3D.Material.REFRACTION_MAP:u={texture:r.getObject(t.readUInt()),alpha:t.readFloat(),ior:t.readFloat()};break;case SEA3D.Material.RIM:u={color:t.readUInt24(),strength:t.readFloat(),power:t.readFloat(),blendMode:t.readBlendMode()};break;case SEA3D.Material.LIGHT_MAP:u={texture:r.getObject(t.readUInt()),channel:t.readByte(),blendMode:t.readBlendMode()};break;case SEA3D.Material.DETAIL_MAP:u={texture:r.getObject(t.readUInt()),scale:t.readFloat(),blendMode:t.readBlendMode()};break;case SEA3D.Material.CEL:u={color:t.readUInt24(),levels:t.readByte(),size:t.readFloat(),specularCutOff:t.readFloat(),smoothness:t.readFloat()};break;case SEA3D.Material.TRANSLUCENT:u={color:t.readUInt24(),translucency:t.readFloat(),scattering:t.readFloat()};break;case SEA3D.Material.BLEND_NORMAL_MAP:methodAttrib=t.readByte(),u={texture:r.getObject(t.readUInt()),secondaryTexture:r.getObject(t.readUInt())},methodAttrib&1?(u.offsetX0=t.readFloat(),u.offsetY0=t.readFloat(),u.offsetX1=t.readFloat(),u.offsetY1=t.readFloat()):u.offsetX0=u.offsetY0=u.offsetX1=u.offsetY1=0,u.animate=methodAttrib&2;break;case SEA3D.Material.MIRROR_REFLECTION:u={texture:r.getObject(t.readUInt()),alpha:t.readFloat()};break;default:console.warn("MaterialTechnique not found:",f.toString(16)),t.position=s+=o;continue}u.kind=f,this.technique.push(u),t.position=s+=o}},SEA3D.Material.DEFAULT=0,SEA3D.Material.COMPOSITE_TEXTURE=1,SEA3D.Material.DIFFUSE_MAP=2,SEA3D.Material.SPECULAR_MAP=3,SEA3D.Material.REFLECTION=4,SEA3D.Material.REFRACTION=5,SEA3D.Material.NORMAL_MAP=6,SEA3D.Material.FRESNEL_REFLECTION=7,SEA3D.Material.RIM=8,SEA3D.Material.LIGHT_MAP=9,SEA3D.Material.DETAIL_MAP=10,SEA3D.Material.CEL=11,SEA3D.Material.TRANSLUCENT=12,SEA3D.Material.BLEND_NORMAL_MAP=13,SEA3D.Material.MIRROR_REFLECTION=14,SEA3D.Material.prototype.type="mat",SEA3D.Composite=function(n,t,i){var u,r;for(this.name=n,this.data=t,this.sea=i,u=t.readByte(),this.layer=[],r=0;r<u;r++)this.layer[r]=this.readLayer(t,this)},SEA3D.Composite.prototype.getLayerByName=function(n){for(var t=0;t<this.layer.length;t++)if(this.layer[t].name==n)return this.layer[t]},SEA3D.Composite.prototype.readLayer=function(n,t){this.scope=t;var i={blendMode:"normal",opacity:1},r=n.readUShort();return r&1?i.texture=this.readLayerBitmap(n,t):i.color=n.readUInt24(),r&2&&(i.mask=this.readLayerBitmap(n,t)),r&4&&(i.name=n.readStringTiny()),r&8&&(i.blendMode=n.readBlendMode()),r&16&&(i.opacity=n.readFloat()),i},SEA3D.Composite.prototype.readLayerBitmap=function(n,t){var i,r;return this.scope=t,i={channel:0,repeat:!0,offsetU:0,offsetV:0,scaleU:0,scaleV:0,rotation:0},i.map=t.sea.getObject(n.readUInt()),r=n.readUShort(),r>0&&(r&1&&(i.channel=n.readByte()),r&2&&(i.repeat=!1),r&4&&(i.offsetU=n.readFloat()),r&8&&(i.offsetV=n.readFloat()),r&16&&(i.scaleU=n.readFloat()),r&32&&(i.scaleV=n.readFloat()),r&64&&(i.rotation=n.readFloat()),r&128&&(i.animation=n.readAnimationList(t.sea))),i},SEA3D.Composite.prototype.type="ctex",SEA3D.CubeMap=function(n,t,i){var f,r,u;for(this.name=n,this.data=t,this.sea=i,this.transparent=!1,f=t.readExt(),this.faces=[],r=0;r<6;r++)u=t.readUInt(),this.faces[r]=t.concat(t.position,u),t.position+=u},SEA3D.CubeMap.prototype.type="cmap",SEA3D.JPEG=function(n,t,i){this.name=n,this.data=t,this.sea=i,this.transparent=!1},SEA3D.JPEG.prototype.type="jpg",SEA3D.JPEG_XR=function(n,t,i){this.name=n,this.data=t,this.sea=i,this.transparent=!1},SEA3D.JPEG_XR.prototype.type="wdp",SEA3D.PNG=function(n,t,i){this.name=n,this.data=t,this.sea=i,this.transparent=t.buffer[25]==6},SEA3D.PNG.prototype.type="png",SEA3D.GIF=function(n,t,i){this.name=n,this.data=t,this.sea=i,this.transparent=t.buffer[11]>0},SEA3D.GIF.prototype.type="gif",SEA3D.File=function(n){this.stream=new SEA3D.Stream(n),this.version=SEA3D.VERSION,this.objects=[],this.typeClass={},this.typeRead={},this.position=this.dataPosition=0,this.scope=this,this.timeLimit=100,this.addClass(SEA3D.Geometry),this.addClass(SEA3D.Mesh),this.addClass(SEA3D.Material),this.addClass(SEA3D.Composite),this.addClass(SEA3D.PointLight),this.addClass(SEA3D.DirectionalLight),this.addClass(SEA3D.Skeleton),this.addClass(SEA3D.SkeletonLocal),this.addClass(SEA3D.SkeletonAnimation),this.addClass(SEA3D.JointObject),this.addClass(SEA3D.Camera),this.addClass(SEA3D.Morph),this.addClass(SEA3D.CubeMap),this.addClass(SEA3D.Animation),this.addClass(SEA3D.JPEG),this.addClass(SEA3D.JPEG_XR),this.addClass(SEA3D.PNG),this.addClass(SEA3D.GIF)},SEA3D.File.CompressionLibs={},SEA3D.File.DecompressionMethod={},SEA3D.File.setDecompressionEngine=function(n,t,i){SEA3D.File.CompressionLibs[n]=t,SEA3D.File.DecompressionMethod[n]=i},SEA3D.File.prototype.addClass=function(n){this.typeClass[n.prototype.type]=n},SEA3D.File.prototype.readHead=function(){if(this.stream.bytesAvailable()<16)return!1;this.stream.readString(3)!="SEA"&&console.error("Invalid SEA3D format.");var n=this.stream.readString(3);if(n!="S3D"&&console.warn('Signature "'+n+'" not recognized.'),this.version=this.stream.readUInt24(),this.stream.readByte()!=0)throw new Error("Protection algorithm not is compatible.");if(this.compressionID=this.stream.readByte(),this.compressionAlgorithm=SEA3D.File.CompressionLibs[this.compressionID],this.decompressionMethod=SEA3D.File.DecompressionMethod[this.compressionID],this.compressionID>0&&!this.decompressionMethod)throw new Error("Compression algorithm not is compatible.");return this.length=this.stream.readUInt(),this.dataPosition=this.stream.position,this.objects.length=0,this.stage=this.readBody,!0},SEA3D.File.prototype.getObject=function(n){return this.objects[n]},SEA3D.File.prototype.readSEAObject=function(){var i,r,u,n;if(this.stream.bytesAvailable()<4||(i=this.stream.readUInt(),r=this.stream.position,this.stream.bytesAvailable()<i))return null;var f=this.stream.readByte(),t=this.stream.readExt(),e=f&1?this.stream.readStringTiny():"",o=(f&2)!=0,s=(f&4)!=0;return i-=this.stream.position-r,r=this.stream.position,u=this.stream.concat(r,i),s&&this.typeClass[t]?(o&&this.decompressionMethod&&u.set(this.decompressionMethod(u.buffer)),n=new this.typeClass[t](e,u,this),this.typeRead[t]&&this.typeRead[t].call(this.scope,n)):(n=new SEA3D.Object(e,u,t,this),console.warn('Unknown format "'+t+'" of the file "'+e+'". Add a module referring to the format.')),this.objects.push(this.objects[n.type+"/"+n.name]=n),this.dataPosition=r+i,++this.position,n},SEA3D.File.prototype.readBody=function(){for(this.timer.update();this.position<this.length;)if(this.timer.getDeltaTime()<this.timeLimit){this.stream.position=this.dataPosition;var n=this.readSEAObject();if(n)this.dispatchCompleteObject(n);else return!1}else return!1;return this.stage=this.readComplete,!0},SEA3D.File.prototype.readComplete=function(){this.stream.position=this.dataPosition,this.stream.readUInt24()!=6202321&&console.warn("SEA3D file is corrupted."),this.stage=null,this.dispatchComplete()},SEA3D.File.prototype.readStage=function(n){while(n.stage&&n.stage());n.stage&&(window.setInterval(n.readStage,10,n),n.dispatchProgress())},SEA3D.File.prototype.read=function(){this.timer=new SEA3D.Timer,this.stage=this.readHead,this.readStage(this)},SEA3D.File.prototype.dispatchCompleteObject=function(n){if(this.onCompleteObject)this.onCompleteObject({file:this,object:n})},SEA3D.File.prototype.dispatchProgress=function(){if(this.onProgress)this.onProgress({file:this,position:this.position,length:this.length,progress:this.position/this.length})},SEA3D.File.prototype.dispatchDownloadProgress=function(n,t){if(this.onDownloadProgress)this.onDownloadProgress({file:this,position:n,length:t,progress:n/t})},SEA3D.File.prototype.dispatchComplete=function(){var n=this.timer.getElapsedTime(),t=n+"ms, "+this.objects.length+" objects";if(this.onComplete)this.onComplete({file:this,timeTotal:n,message:t});else console.log("SEA3D:",t)},SEA3D.File.prototype.dispatchError=function(n,t){if(this.onError)this.onError({file:this,id:n,message:t});else console.error("SEA3D: #"+n,t)},SEA3D.File.prototype.load=function(n){var i=this,t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="arraybuffer",t.onprogress=function(n){n.lengthComputable&&i.dispatchDownloadProgress(n.loaded,n.total)},t.onreadystatechange=function(){t.readyState===2||t.readyState===3||t.readyState===4&&(t.status===200||t.status===0?(i.stream.set(new Uint8Array(this.response)),i.read()):this.dispatchError(1001,"Couldn't load ["+n+"] ["+t.status+"]"))},t.send()},function(n){var c=32768,ct=0,ni=1,ti=2,lt=9,at=6,ii=32768,ri=64,o,f,b=null,it,k,ui,y,a,s,p,u,v,h,nt,e,l,d,tt,vt=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],rt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ut=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],ft=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],st=function(){this.next=null,this.list=null},ht=function(){this.e=0,this.b=0,this.n=0,this.t=null},w=function(n,t,i,r,u,f){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;for(var ut,a=new Array(this.BMAX+1),ft,nt,it,s,o,y,p=new Array(this.BMAX+1),v,l,w,h=new ht,d=new Array(this.BMAX),et=new Array(this.N_MAX),c,b=new Array(this.BMAX+1),rt,tt,k,ot,g=this.root=null,e=0;e<a.length;e++)a[e]=0;for(e=0;e<p.length;e++)p[e]=0;for(e=0;e<d.length;e++)d[e]=null;for(e=0;e<et.length;e++)et[e]=0;for(e=0;e<b.length;e++)b[e]=0;ft=t>256?n[256]:this.BMAX,v=n,l=0,e=t;do a[v[l]]++,l++;while(--e>0);if(a[0]==t){this.root=null,this.m=0,this.status=0;return}for(o=1;o<=this.BMAX;o++)if(a[o]!=0)break;for(y=o,f<o&&(f=o),e=this.BMAX;e!=0;e--)if(a[e]!=0)break;for(it=e,f>e&&(f=e),tt=1<<o;o<e;o++,tt<<=1)if((tt-=a[o])<0){this.status=2,this.m=f;return}if((tt-=a[e])<0){this.status=2,this.m=f;return}for(a[e]+=tt,b[1]=o=0,v=a,l=1,rt=2;--e>0;)b[rt++]=o+=v[l++];v=n,l=0,e=0;do(o=v[l++])!=0&&(et[b[o]++]=e);while(++e<t);for(t=b[it],b[0]=e=0,v=et,l=0,s=-1,c=p[0]=0,w=null,k=0;y<=it;y++)for(ut=a[y];ut-->0;){while(y>c+p[1+s]){if(c+=p[1+s],s++,k=(k=it-c)>f?f:k,(nt=1<<(o=y-c))>ut+1)for(nt-=ut+1,rt=y;++o<k;){if((nt<<=1)<=a[++rt])break;nt-=a[rt]}for(c+o>ft&&c<ft&&(o=ft-c),k=1<<o,p[1+s]=o,w=new Array(k),ot=0;ot<k;ot++)w[ot]=new ht;g=g==null?this.root=new st:g.next=new st,g.next=null,g.list=w,d[s]=w,s>0&&(b[s]=e,h.b=p[s],h.e=16+o,h.t=w,o=(e&(1<<c)-1)>>c-p[s],d[s-1][o].e=h.e,d[s-1][o].b=h.b,d[s-1][o].n=h.n,d[s-1][o].t=h.t)}for(h.b=y-c,l>=t?h.e=99:v[l]<i?(h.e=v[l]<256?16:15,h.n=v[l++]):(h.e=u[v[l]-i],h.n=r[v[l++]-i]),nt=1<<y-c,o=e>>c;o<k;o+=nt)w[o].e=h.e,w[o].b=h.b,w[o].n=h.n,w[o].t=h.t;for(o=1<<y-1;(e&o)!=0;o>>=1)e^=o;for(e^=o;(e&(1<<c)-1)!=b[s];)c-=p[s],s--}this.m=p[1],this.status=tt!=0&&it!=1?1:0},yt=function(){return d.length==tt?-1:d[tt++]},i=function(n){while(a<n)y|=yt()<<a,a+=8},r=function(n){return y&vt[n]},t=function(n){y>>=n,a-=n},g=function(n,a,y){var p,w,b;if(y==0)return 0;for(b=0;;){for(i(e),w=h.list[r(e)],p=w.e;p>16;){if(p==99)return-1;t(w.b),p-=16,i(p),w=w.t[r(p)],p=w.e}if(t(w.b),p==16){if(f&=c-1,n[a+b++]=o[f++]=w.n,b==y)return y;continue}if(p==15)break;for(i(p),u=w.n+r(p),t(p),i(l),w=nt.list[r(l)],p=w.e;p>16;){if(p==99)return-1;t(w.b),p-=16,i(p),w=w.t[r(p)],p=w.e}for(t(w.b),i(p),v=f-w.n-r(p),t(p);u>0&&b<y;)u--,v&=c-1,f&=c-1,n[a+b++]=o[f++]=o[v++];if(b==y)return y}return s=-1,b},pt=function(n,e,h){var l;if(l=a&7,t(l),i(16),l=r(16),t(16),i(16),l!=(~y&65535))return-1;for(t(16),u=l,l=0;u>0&&l<h;)u--,f&=c-1,i(8),n[e+l++]=o[f++]=r(8),t(8);return u==0&&(s=-1),l},wt=function(n,t,i){if(b==null){for(var f=new Array(288),u,r=0;r<144;r++)f[r]=8;for(;r<256;r++)f[r]=9;for(;r<280;r++)f[r]=7;for(;r<288;r++)f[r]=8;if(k=7,u=new w(f,288,257,rt,ut,k),u.status!=0)return alert("HufBuild error: "+u.status),-1;for(b=u.root,k=u.m,r=0;r<30;r++)f[r]=5;if(zip_fixed_bd=5,u=new w(f,30,0,ft,et,zip_fixed_bd),u.status>1)return b=null,alert("HufBuild error: "+u.status),-1;it=u.root,zip_fixed_bd=u.m}return h=b,nt=it,e=k,l=zip_fixed_bd,g(n,t,i)},bt=function(n,u,f){for(var o,y,p,k,d,v,b,a=new Array(316),c,s=0;s<a.length;s++)a[s]=0;if(i(5),v=257+r(5),t(5),i(5),b=1+r(5),t(5),i(4),d=4+r(4),t(4),v>286||b>30)return-1;for(o=0;o<d;o++)i(3),a[ot[o]]=r(3),t(3);for(;o<19;o++)a[ot[o]]=0;if(e=7,c=new w(a,19,19,null,null,e),c.status!=0)return-1;for(h=c.root,e=c.m,p=v+b,s=y=0;s<p;)if(i(e),k=h.list[r(e)],o=k.b,t(o),o=k.n,o<16)a[s++]=y=o;else if(o==16){if(i(2),o=3+r(2),t(2),s+o>p)return-1;while(o-->0)a[s++]=y}else if(o==17){if(i(3),o=3+r(3),t(3),s+o>p)return-1;while(o-->0)a[s++]=0;y=0}else{if(i(7),o=11+r(7),t(7),s+o>p)return-1;while(o-->0)a[s++]=0;y=0}if(e=lt,c=new w(a,v,257,rt,ut,e),e==0&&(c.status=1),c.status!=0)return c.status==1,-1;for(h=c.root,e=c.m,s=0;s<b;s++)a[s]=a[s+v];return(l=at,c=new w(a,b,0,ft,et,l),nt=c.root,l=c.m,l==0&&v>257)?-1:(c.status==1,c.status!=0)?-1:g(n,u,f)},kt=function(){var n;o==null&&(o=new Array(2*c)),f=0,y=0,a=0,s=-1,p=!1,u=v=0,h=null},dt=function(n,e,l){for(var y,a=0;a<l;){if(p&&s==-1)return a;if(u>0){if(s!=ct)while(u>0&&a<l)u--,v&=c-1,f&=c-1,n[e+a++]=o[f++]=o[v++];else{while(u>0&&a<l)u--,f&=c-1,i(8),n[e+a++]=o[f++]=r(8),t(8);u==0&&(s=-1)}if(a==l)return a}if(s==-1){if(p)break;i(1),r(1)!=0&&(p=!0),t(1),i(2),s=r(2),t(2),h=null,u=0}switch(s){case 0:y=pt(n,e+a,l-a);break;case 1:y=h!=null?g(n,e+a,l-a):wt(n,e+a,l-a);break;case 2:y=h!=null?g(n,e+a,l-a):bt(n,e+a,l-a);break;default:y=-1}if(y==-1)return p?0:-1;a+=y}return a},gt=function(n){var u,t,f=0,i,r;for(kt(),d=n,tt=0,i=new Uint8Array(1024),r=[];(u=dt(i,0,i.length))>0;)for(t=0;t<u;t++)r[f++]=i[t];return d=null,new Uint8Array(r)};n.RawDeflate||(n.RawDeflate={}),n.RawDeflate.inflate=gt}(this),SEA3D.File.DeflateUncompress=function(n){return RawDeflate.inflate(n)},SEA3D.File.setDecompressionEngine(1,"deflate",SEA3D.File.DeflateUncompress),LZMA=LZMA||{},LZMA.OutWindow=function(){this._windowSize=0},LZMA.OutWindow.prototype.create=function(n){this._buffer&&this._windowSize===n||(this._buffer=[]),this._windowSize=n,this._pos=0,this._streamPos=0},LZMA.OutWindow.prototype.flush=function(){var n=this._pos-this._streamPos;if(n!==0){while(n--)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},LZMA.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},LZMA.OutWindow.prototype.setStream=function(n){this.releaseStream(),this._stream=n},LZMA.OutWindow.prototype.init=function(n){n||(this._streamPos=0,this._pos=0)},LZMA.OutWindow.prototype.copyBlock=function(n,t){var i=this._pos-n-1;for(i<0&&(i+=this._windowSize);t--;)i>=this._windowSize&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.putByte=function(n){this._buffer[this._pos++]=n,this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.getByte=function(n){var t=this._pos-n-1;return t<0&&(t+=this._windowSize),this._buffer[t]},LZMA.RangeDecoder=function(){},LZMA.RangeDecoder.prototype.setStream=function(n){this._stream=n},LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null},LZMA.RangeDecoder.prototype.init=function(){var n=5;for(this._code=0,this._range=-1;n--;)this._code=this._code<<8|this._stream.readByte()},LZMA.RangeDecoder.prototype.decodeDirectBits=function(n){for(var t=0,r=n,i;r--;)this._range>>>=1,i=this._code-this._range>>>31,this._code-=this._range&i-1,t=t<<1|1-i,(this._range&4278190080)==0&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return t},LZMA.RangeDecoder.prototype.decodeBit=function(n,t){var r=n[t],i=(this._range>>>11)*r;return(this._code^2147483648)<(i^2147483648)?(this._range=i,n[t]+=2048-r>>>5,(this._range&4278190080)==0&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=i,this._code-=i,n[t]-=r>>>5,(this._range&4278190080)==0&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},LZMA.initBitModels=function(n,t){while(t--)n[t]=1024},LZMA.BitTreeDecoder=function(n){this._models=[],this._numBitLevels=n},LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.decode=function(n){for(var t=1,i=this._numBitLevels;i--;)t=t<<1|n.decodeBit(this._models,t);return t-(1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.reverseDecode=function(n){for(var t=1,u=0,i=0,r;i<this._numBitLevels;++i)r=n.decodeBit(this._models,t),t=t<<1|r,u|=r<<i;return u},LZMA.reverseDecode2=function(n,t,i,r){for(var u=1,o=0,f=0,e;f<r;++f)e=i.decodeBit(n,t+u),u=u<<1|e,o|=e<<f;return o},LZMA.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new LZMA.BitTreeDecoder(8),this._numPosStates=0},LZMA.LenDecoder.prototype.create=function(n){for(;this._numPosStates<n;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)},LZMA.LenDecoder.prototype.init=function(){var n=this._numPosStates;for(LZMA.initBitModels(this._choice,2);n--;)this._lowCoder[n].init(),this._midCoder[n].init();this._highCoder.init()},LZMA.LenDecoder.prototype.decode=function(n,t){return n.decodeBit(this._choice,0)===0?this._lowCoder[t].decode(n):n.decodeBit(this._choice,1)===0?8+this._midCoder[t].decode(n):16+this._highCoder.decode(n)},LZMA.Decoder2=function(){this._decoders=[]},LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)},LZMA.Decoder2.prototype.decodeNormal=function(n){var t=1;do t=t<<1|n.decodeBit(this._decoders,t);while(t<256);return t&255},LZMA.Decoder2.prototype.decodeWithMatchByte=function(n,t){var i=1,r,u;do if(r=t>>7&1,t<<=1,u=n.decodeBit(this._decoders,(1+r<<8)+i),i=i<<1|u,r!==u){while(i<256)i=i<<1|n.decodeBit(this._decoders,i);break}while(i<256);return i&255},LZMA.LiteralDecoder=function(){},LZMA.LiteralDecoder.prototype.create=function(n,t){var i;if(!this._coders||this._numPrevBits!==t||this._numPosBits!==n)for(this._numPosBits=n,this._posMask=(1<<n)-1,this._numPrevBits=t,this._coders=[],i=1<<this._numPrevBits+this._numPosBits;i--;)this._coders[i]=new LZMA.Decoder2},LZMA.LiteralDecoder.prototype.init=function(){for(var n=1<<this._numPrevBits+this._numPosBits;n--;)this._coders[n].init()},LZMA.LiteralDecoder.prototype.getDecoder=function(n,t){return this._coders[((n&this._posMask)<<this._numPrevBits)+((t&255)>>>8-this._numPrevBits)]},LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow,this._rangeDecoder=new LZMA.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new LZMA.BitTreeDecoder(4),this._lenDecoder=new LZMA.LenDecoder,this._repLenDecoder=new LZMA.LenDecoder,this._literalDecoder=new LZMA.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)},LZMA.Decoder.prototype.setDictionarySize=function(n){return n<0?!1:(this._dictionarySize!==n&&(this._dictionarySize=n,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},LZMA.Decoder.prototype.setLcLpPb=function(n,t,i){var r=1<<i;return n>8||t>4||i>4?!1:(this._literalDecoder.create(t,n),this._lenDecoder.create(r),this._repLenDecoder.create(r),this._posStateMask=r-1,!0)},LZMA.Decoder.prototype.init=function(){var n=4;for(this._outWindow.init(!1),LZMA.initBitModels(this._isMatchDecoders,192),LZMA.initBitModels(this._isRep0LongDecoders,192),LZMA.initBitModels(this._isRepDecoders,12),LZMA.initBitModels(this._isRepG0Decoders,12),LZMA.initBitModels(this._isRepG1Decoders,12),LZMA.initBitModels(this._isRepG2Decoders,12),LZMA.initBitModels(this._posDecoders,114),this._literalDecoder.init();n--;)this._posSlotDecoder[n].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},LZMA.Decoder.prototype.decode=function(n,t,i){var r=0,u=0,o=0,s=0,y=0,h=0,c=0,l,p,f,a,e,v;for(this._rangeDecoder.setStream(n),this._outWindow.setStream(t),this.init();i<0||h<i;)if(l=h&this._posStateMask,this._rangeDecoder.decodeBit(this._isMatchDecoders,(r<<4)+l)===0)p=this._literalDecoder.getDecoder(h++,c),c=r>=7?p.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(u)):p.decodeNormal(this._rangeDecoder),this._outWindow.putByte(c),r=r<4?0:r-(r<10?3:6);else{if(this._rangeDecoder.decodeBit(this._isRepDecoders,r)===1)f=0,this._rangeDecoder.decodeBit(this._isRepG0Decoders,r)===0?this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(r<<4)+l)===0&&(r=r<7?9:11,f=1):(this._rangeDecoder.decodeBit(this._isRepG1Decoders,r)===0?a=o:(this._rangeDecoder.decodeBit(this._isRepG2Decoders,r)===0?a=s:(a=y,y=s),s=o),o=u,u=a),f===0&&(f=2+this._repLenDecoder.decode(this._rangeDecoder,l),r=r<7?8:11);else if(y=s,s=o,o=u,f=2+this._lenDecoder.decode(this._rangeDecoder,l),r=r<7?7:10,e=this._posSlotDecoder[f<=5?f-2:3].decode(this._rangeDecoder),e>=4){if(v=(e>>1)-1,u=(2|e&1)<<v,e<14)u+=LZMA.reverseDecode2(this._posDecoders,u-e-1,this._rangeDecoder,v);else if(u+=this._rangeDecoder.decodeDirectBits(v-4)<<4,u+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),u<0){if(u===-1)break;return!1}}else u=e;if(u>=h||u>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(u,f),h+=f,c=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},LZMA.Decoder.prototype.setDecoderProperties=function(n){var t,r,u,f,i;return n.size<5?!1:(t=n.readByte(),r=t%9,t=~~(t/9),u=t%5,f=~~(t/5),!this.setLcLpPb(r,u,f))?!1:(i=n.readByte(),i|=n.readByte()<<8,i|=n.readByte()<<16,i+=n.readByte()*16777216,this.setDictionarySize(i))},LZMA.decompress=function(n,t,i,r){var u=new LZMA.Decoder;if(!u.setDecoderProperties(n))throw"Incorrect stream properties";if(!u.decode(t,i,r))throw"Error in data stream";return!0},LZMA.decompressFile=function(n,t){var r=new LZMA.Decoder,i;if(!r.setDecoderProperties(n))throw"Incorrect stream properties";if(i=n.readByte(),i|=n.readByte()<<8,i|=n.readByte()<<16,i+=n.readByte()*16777216,n.readByte(),n.readByte(),n.readByte(),n.readByte(),!r.decode(n,t,i))throw"Error in data stream";return!0},SEA3D.File.LZMAUncompress=function(n){var i={data:n,position:0,readByte:function(){return this.data[this.position++]}},t={data:[],position:0,writeByte:function(n){this.data[this.position++]=n}};return LZMA.decompressFile(i,t),new Uint8Array(t.data)},SEA3D.File.setDecompressionEngine(2,"lzma",SEA3D.File.LZMAUncompress),THREE.Object3D.prototype.UPDATEMATRIXWORLD=THREE.Mesh.prototype.updateMatrixWorld,THREE.Object3D.prototype.updateMatrixWorld=function(n){this.animateMatrix&&(this.matrixWorldNeedsUpdate||n)?(this.UPDATEMATRIXWORLD(n),this.animateMatrix.compose(this.animatePosition,this.animateQuaternion,this.animateScale),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.animateMatrix)):this.UPDATEMATRIXWORLD(n)},THREE.Object3D.prototype.setAnimateMatrix=function(n){this.getAnimateMatrix()!=n&&(n?(this.animateMatrix=new THREE.Matrix4,this.animatePosition=new THREE.Vector3,this.animateQuaternion=new THREE.Quaternion,this.animateScale=new THREE.Vector3(1,1,1)):(delete this.animateMatrix,delete this.animatePosition,delete this.animateQuaternion,delete this.animateScale),this.matrixWorldNeedsUpdate=!0)},THREE.Object3D.prototype.getAnimateMatrix=function(){return this.animateMatrix!=null},THREE.Mesh.prototype.setWeightByName=function(n,t){this.morphTargetInfluences[this.geometry.morphTargets[n]]=t},THREE.Mesh.prototype.getWeightByName=function(n){return this.morphTargetInfluences[this.geometry.morphTargets[n]]},THREE.Mesh.prototype.DISPOSE=THREE.Mesh.prototype.dispose,THREE.Mesh.prototype.dispose=function(){this.animation&&this.animation.dispose(),this.DISPOSE()},THREE.Mesh.prototype.CLONE=THREE.Mesh.prototype.clone,THREE.Mesh.prototype.clone=function(n){var t=this.CLONE(n);return t.animation&&(t.animation=this.animation.clone(t)),t},THREE.SkinnedMesh.prototype.stop=function(){this.currentAnimation&&(this.currentAnimation.stop(),this.currentAnimation=null)},THREE.SkinnedMesh.prototype.pause=function(){this.currentAnimation&&this.currentAnimation.pause()},THREE.SkinnedMesh.prototype.play=function(n,t){this.currentAnimation&&(this.currentAnimation.stop(),this.currentAnimation=null),this.currentAnimation=this.animations[n],this.currentAnimation.play(this.currentAnimation.loop,t)},THREE.SkinnedMesh.prototype.addAnimations=function(n){var i,t,r,u;this.animations=[],i=n[0].name.indexOf("/")+1,this.animationNamespace=n[0].name.substring(0,i);for(t in n)THREE.AnimationHandler.add(n[t]),r=n[t].name,u=r.substring(i),this.animations[t]=new THREE.Animation(this,r),this.animations[t].loop=n[t].repeat,this.animations[t].name=u,this.animations[u]=this.animations[t]},THREE.SkinnedMesh.prototype.DISPOSE=THREE.SkinnedMesh.prototype.dispose,THREE.SkinnedMesh.prototype.dispose=function(){this.stop(),this.animations=null,this.DISPOSE()},THREE.SkinnedMesh.prototype.CLONE=THREE.SkinnedMesh.prototype.clone,THREE.SkinnedMesh.prototype.clone=function(n){var i=this.CLONE(n),t;i.animations=[];for(t in this.animations)i.animations[t]=new THREE.Animation(i,this.animations[t].data.name),i.animations[t].loop=this.animations[t].loop,i.animations[t].name=this.animations[t].name;return i},THREE.BoneObject={creat:function(n,t){var i=new THREE.Object3D;return i.name=t.name,i.matrix=t.skinMatrix,i.matrixAutoUpdate=!1,n.add(i),i}},THREE.SEA3D=function(n){this.container=undefined,this.invertZ=n!=undefined?!n:!0,this.invertCamera=n!=undefined?n:!1,this.matrixAutoUpdate=!0,this.autoPlay=!0,this.objects={}},THREE.SEA3D.prototype={constructor:THREE.SEA3D,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent},THREE.SEA3D.prototype.setShadowMap=function(n,t){n.shadowMapWidth=n.shadowMapHeight=2048,n.castShadow=!0,n.shadowDarkness=t},THREE.SEA3D.prototype.getMesh=function(n){return this.objects["m3d/"+n]},THREE.SEA3D.prototype.getMaterial=function(n){return this.objects["mat/"+n]},THREE.SEA3D.prototype.getLight=function(n){return this.objects["lht/"+n]},THREE.SEA3D.prototype.getCamera=function(n){return this.objects["cam/"+n]},THREE.SEA3D.prototype.getTexture=function(n){return this.objects["tex/"+n]},THREE.SEA3D.prototype.getCubeMap=function(n){return this.objects["cmap/"+n]},THREE.SEA3D.prototype.getJointObject=function(n){return this.objects["jnt/"+n]},THREE.SEA3D.prototype.isPowerOfTwo=function(n){return n?(n&-n)==n:!1},THREE.SEA3D.prototype.nearestPowerOfTwo=function(n){return Math.pow(2,Math.round(Math.log(n)/Math.LN2))},THREE.SEA3D.prototype.vectorToVector3=function(n){for(var i=[],t=0,r=0;t<n.length;)i[r++]=new THREE.Vector3(n[t++],n[t++],n[t++]);return i},THREE.SEA3D.prototype.morphVectorToVector3=function(n,t){for(var r=[],i=0,u=0;i<n.length;)r[u++]=new THREE.Vector3(n[i]+t[i++],n[i]+t[i++],n[i]+t[i++]);return r},THREE.SEA3D.prototype.vectorToUV=function(n){for(var u=[],f,r,i,e,t=0;t<n.length;t++)for(f=u[t]=[],r=n[t],i=0,e=0;i<r.length;i+=2)f[e++]=new THREE.Vector2(r[i],r[i+1]);return u},THREE.SEA3D.prototype.toVector3=function(n){return new THREE.Vector3(n.x,n.y,n.z)},THREE.SEA3D.prototype.scaleColor=function(n,t){var i=(n>>16)*t,r=(n>>8&255)*t,u=(n&255)*t;return i<<16|r<<8|u},THREE.SEA3D.prototype.applyMatrix=function(n,t,i){n.position.setFromMatrixPosition(t),n.rotation.setFromRotationMatrix(t),n.scale.setFromMatrixScale(t),i&&(n.position.z=-n.position.z,n.scale.z=-n.scale.z)},THREE.SEA3D.prototype.updateMatrix=function(n,t){var i=new THREE.Matrix4;i.elements=t.transform,t.isStatic?(this.invertZ?this.applyMatrix(n,i,!t.parent):n.matrix=i,n.matrixAutoUpdate=!1):(this.applyMatrix(n,i,this.invertZ&&!t.parent),n.matrixAutoUpdate=this.matrixAutoUpdate)},THREE.SEA3D.prototype.addSceneObject=function(n){n.parent?n.parent.tag.add(n.tag):this.container&&this.container.add(n.tag)},THREE.SEA3D.prototype.bufferToTexture=function(n){for(var t=0,r=n.length,i="";t<r;)i+=String.fromCharCode(n[t++]);return"data:image/png;base64,"+window.btoa(i)},THREE.SEA3D.prototype.applyDefaultAnimation=function(n,t){var i=n.tag,u,r;for(u in n.animations){r=n.animations[u];switch(r.tag.type){case SEA3D.Animation.prototype.type:return i.animation=new t(i,r.tag.tag),i.animation.setRelative(r.relative),this.autoPlay&&i.animation.play(i.animation.getStateNameByIndex(0)),i.animation}}},THREE.SEA3D.prototype.readAnimation=function(n){var u=new SEA3D.AnimationSet,f,t,r,e,i;for(f in n.sequence){t=n.sequence[f],r=new SEA3D.AnimationNode(t.name,n.frameRate,t.count,t.repeat,t.intrpl);for(e in n.dataList)i=n.dataList[e],r.addData(new SEA3D.AnimationData(i.kind,i.type,i.data,t.start*i.blockSize));u.addAnimation(r)}this.animationSets=this.animationSets||[],this.animationSets.push(this.objects[n.name+".#anm"]=n.tag=u)},THREE.SEA3D.Object3DAnimator=function(n,t){SEA3D.AnimationHandler.call(this,t),this.object3d=n},THREE.SEA3D.Object3DAnimator.prototype=Object.create(SEA3D.AnimationHandler.prototype),THREE.SEA3D.Object3DAnimator.prototype.setRelative=function(n){this.object3d.setAnimateMatrix(this.relative=n)},THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame=function(n,t){var i;if(this.relative){switch(t){case SEA3D.Animation.POSITION:i=n.toVector(),this.object3d.animatePosition.set(i.x,i.y,i.z);break;case SEA3D.Animation.ROTATION:i=n.toVector(),this.object3d.animateQuaternion.set(i.x,i.y,i.z,i.w);break;case SEA3D.Animation.SCALE:i=n.toVector(),this.object3d.animateScale.set(i.x,i.y,i.z)}this.object3d.matrixWorldNeedsUpdate=!0}else switch(t){case SEA3D.Animation.POSITION:i=n.toVector(),this.object3d.position.set(i.x,i.y,i.z);break;case SEA3D.Animation.ROTATION:i=n.toVector(),this.object3d.quaternion.set(i.x,i.y,i.z,i.w);break;case SEA3D.Animation.SCALE:i=n.toVector(),this.object3d.scale.set(i.x,i.y,i.z)}},THREE.SEA3D.CameraAnimator=function(n,t){THREE.SEA3D.Object3DAnimator.call(this,n,t)},THREE.SEA3D.CameraAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype),THREE.SEA3D.CameraAnimator.prototype.updateAnimationFrame=function(n,t){switch(t){case SEA3D.Animation.FOV:this.object3d.fov=n.getX();break;default:this.$updateAnimationFrame(n,t)}},THREE.SEA3D.CameraAnimator.prototype.$updateAnimationFrame=THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame,THREE.SEA3D.LightAnimator=function(n,t){THREE.SEA3D.Object3DAnimator.call(this,n,t)},THREE.SEA3D.LightAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype),THREE.SEA3D.LightAnimator.prototype.updateAnimationFrame=function(n,t){switch(t){case SEA3D.Animation.COLOR:this.object3d.color.setHex(n.getX());break;case SEA3D.Animation.MULTIPLIER:this.object3d.intensity=n.getX();break;default:this.$updateAnimationFrame(n,t)}},THREE.SEA3D.LightAnimator.prototype.$updateAnimationFrame=THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame,THREE.SEA3D.prototype.readGeometry=function(n){var o,l,t,i,r=new THREE.Geometry,it,a,s,h,d,v,y,p,w,g,k,nt,e,tt,b;it=r.vertices=this.vectorToVector3(n.vertex),a=this.vectorToVector3(n.normal),s=this.vectorToUV(n.uv);for(t in s)r.faceVertexUvs[t]=[];for(o in n.indexes)for(h=n.indexes[o],d=h.length/3,l=0;l<d;l++){v=l*3,y=h[v],w=h[v+1],p=h[v+2],g=[a[y],a[p],a[w]],k=new THREE.Face3(y,p,w,g),k.materialIndex=o,r.faces.push(k);for(t in s)nt=[s[t][y],s[t][p],s[t][w]],r.faceVertexUvs[t].push(nt)}if(n.joint){var u=[0,0,0,0],f=[0,0,0,0],c=n.jointPerVertex;if(c>4)for(console.warn("WebGLRenderer: Joint Per Vertex can not be greater than 4 (currently "+n.jointPerVertex+"). Using compression for joints."),t=0;t<n.joint.length;t+=c){for(e=[0],i=1;i<c;i++)b=n.weight[t+i],tt=n.weight[t+e[0]],b>tt?e.unshift(i):e.push(i);for(b=1-(n.weight[t+e[0]]+n.weight[t+e[1]]+n.weight[t+e[2]]+n.weight[t+e[3]]),i=0;i<4;i++)o=e[i],u[i]=n.joint[t+o],f[i]=n.weight[t+o]+b;r.skinIndices.push(new THREE.Vector4(u[0],u[1],u[2],u[3])),r.skinWeights.push(new THREE.Vector4(f[0],f[1],f[2],f[3]))}else for(t=0;t<n.joint.length;t+=c){for(i=0;i<c;i++)u[i]=n.joint[t+i],f[i]=n.weight[t+i];r.skinIndices.push(new THREE.Vector4(u[0],u[1],u[2],u[3])),r.skinWeights.push(new THREE.Vector4(f[0],f[1],f[2],f[3]))}}n.tangent||r.computeTangents(),r.computeBoundingBox(),r.computeBoundingSphere(),r.name=n.name,n.tag=r},THREE.SEA3D.prototype.readMesh=function(n){var r=n.geometry.tag,i,u,f,c,o,s,h,l,e,t;for(t in n.modifiers){h=n.modifiers[t];switch(h.type){case SEA3D.Skeleton.prototype.type:f=h,r.bones=f.tag;break;case SEA3D.Morph.prototype.type:o=h,s=n.geometry.normal!=null}}for(t in n.animations){l=n.animations[t];switch(l.tag.type){case SEA3D.SkeletonAnimation.prototype.type:c=l.tag,r.animations=this.getSkeletonAnimation(c,f)}}if(n.material)if(n.material.length>1){for(e=[],t=0;t<n.material.length;t++)e[t]=n.material[t].tag,e[t].skinning=f!=null,e[t].morphTargets=o!=null,e[t].morpherNormals=s;u=new THREE.MeshFaceMaterial(e)}else u=n.material[0].tag,u.skinning=f!=null,u.morphTargets=o!=null,u.morpherNormals=s;o&&(r.morphTargets=this.getMorpher(o,n.geometry),s||r.computeMorphNormals()),f?(i=new THREE.SkinnedMesh(r,u,!1),c&&(i.addAnimations(r.animations),this.autoPlay&&i.play(i.animations[0].name))):i=new THREE.Mesh(r,u),i.name=n.name,i.castShadow=n.castShadows,i.receiveShadow=n.material?n.material[0].receiveShadows:!0,this.meshes=this.meshes||[],this.meshes.push(this.objects["m3d/"+n.name]=n.tag=i),this.updateMatrix(i,n),this.addSceneObject(n),this.applyDefaultAnimation(n,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readImage=function(n){var t=new Image,i=new THREE.Texture,r=this;i.name=n.name,i.wrapS=i.wrapT=THREE.RepeatWrapping,i.flipY=!1,t.onload=function(){var e;if(!r.isPowerOfTwo(t.width)||!r.isPowerOfTwo(t.height)){var u=r.nearestPowerOfTwo(t.width),f=r.nearestPowerOfTwo(t.height),n=document.createElement("canvas");n.width=u,n.height=f,e=n.getContext("2d"),e.drawImage(t,0,0,u,f),t=n}i.image=t,i.needsUpdate=!0},t.src=this.bufferToTexture(n.data.buffer),this.textures=this.textures||[],this.textures.push(this.objects["tex/"+n.name]=n.tag=i)},THREE.SEA3D.prototype.readCubeMap=function(n){var r=[],t=new THREE.Texture,i,f,u;for(r.loadCount=0,t.name=n.name,t.image=r,t.flipY=!1,i=0,f=n.faces.length;i<f;++i)u=new Image,r[i]=u,u.onload=function(){++r.loadCount==6&&(t.needsUpdate=!0)},u.src=this.bufferToTexture(n.faces[i].buffer);this.cubmaps=this.cubmaps||[],this.cubmaps.push(this.objects["cmap/"+n.name]=n.tag=t)},THREE.SEA3D.prototype.blendMode={add:THREE.AdditiveBlending,subtract:THREE.SubtractiveBlending,multiply:THREE.SubtractiveBlending},THREE.SEA3D.prototype.materialTechnique=function(){var n={};return n[SEA3D.Material.DEFAULT]=function(n,t){t.emissive.setHex(n.ambientColor),t.color.setHex(n.diffuseColor),t.specular.setHex(this.scaleColor(n.specularColor,n.specular)),t.shininess=n.gloss},n[SEA3D.Material.DIFFUSE_MAP]=function(n,t){t.map=n.texture.tag,t.transparent=n.texture.transparent},n[SEA3D.Material.SPECULAR_MAP]=function(n,t){t.specularMap=n.texture.tag},n[SEA3D.Material.NORMAL_MAP]=function(n,t){t.normalMap=n.texture.tag},n[SEA3D.Material.REFLECTION_MAP]=n[SEA3D.Material.FRESNEL_REFLECTION]=function(n,t){t.envMap=n.texture.tag.clone(),t.envMap.mapping=new THREE.CubeReflectionMapping,t.reflectivity=n.alpha,n.kind==SEA3D.Material.FRESNEL_REFLECTION},n[SEA3D.Material.REFRACTION_MAP]=function(n,t){t.envMap=n.texture.tag.clone(),t.envMap.mapping=new THREE.CubeRefractionMapping,t.refractionRatio=n.ior,t.reflectivity=n.alpha},n[SEA3D.Material.LIGHT_MAP]=function(n,t){t.lightMap=n.texture.tag},n}(),THREE.SEA3D.prototype.readMaterial=function(n){var t=new THREE.MeshPhongMaterial,r,i;t.name=n.name,t.side=n.bothSides?THREE.DoubleSide:THREE.FrontSide,t.shading=n.smooth?THREE.SmoothShading:THREE.FlatShading,n.blendMode!="normal"&&this.blendMode[n.blendMode]&&(t.blending=this.blendMode[n.blendMode]),(n.alpha<1||t.blending>THREE.NormalBlending)&&(t.opacity=n.alpha,t.transparent=!0);for(r in n.technique)i=n.technique[r],this.materialTechnique[i.kind]&&this.materialTechnique[i.kind].call(this,i,t);t.transparent&&(t.alphaTest=n.alphaThreshold),this.materials=this.materials||[],this.materials.push(this.objects["mat/"+n.name]=n.tag=t)},THREE.SEA3D.prototype.readPointLight=function(n){var t=new THREE.PointLight(n.color,n.multiplier);t.name=n.name,this.invertZ?t.position.set(n.position.x,n.position.y,-n.position.z):t.position.set(n.position.x,n.position.y,n.position.z),n.shadow&&this.setShadowMap(t,n.shadow.opacity),this.lights=this.lights||[],this.lights.push(this.objects["lht/"+n.name]=n.tag=t),this.addSceneObject(n),this.applyDefaultAnimation(n,THREE.SEA3D.LightAnimator)},THREE.SEA3D.prototype.readDirectionalLight=function(n){var t=new THREE.DirectionalLight(n.color,n.multiplier);t.name=n.name,this.updateMatrix(t,n),n.shadow&&this.setShadowMap(t,n.shadow.opacity),this.lights=this.lights||[],this.lights.push(this.objects["lht/"+n.name]=n.tag=t),this.addSceneObject(n),this.applyDefaultAnimation(n,THREE.SEA3D.LightAnimator)},THREE.SEA3D.prototype.readCamera=function(n){var t=new THREE.PerspectiveCamera(n.fov);t.name=n.name,this.updateMatrix(t,n),this.invertCamera&&t.scale.set(-1,1,1),this.cameras=this.camera||[],this.cameras.push(this.objects["cam/"+n.name]=n.tag=t),this.addSceneObject(n),this.applyDefaultAnimation(n,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.readSkeleton=function(n){var o=[],u=new THREE.Matrix4,t=new THREE.Matrix4,f=new THREE.Vector3,r=new THREE.Quaternion,e,i;rootMatrix=new THREE.Matrix4,rootMatrix.elements=n.joint[0].inverseBindMatrix;for(e in n.joint)i=n.joint[e],u.elements=i.inverseBindMatrix,t=new THREE.Matrix4,t.getInverse(u),i.parentIndex>-1&&(u.elements=n.joint[i.parentIndex].inverseBindMatrix,t.multiplyMatrices(u,t)),f.setFromMatrixPosition(t),r.setFromRotationMatrix(t),o[e]={name:i.name,pos:[f.x,f.y,f.z],rotq:[r.x,r.y,r.z,r.w],parent:i.parentIndex};n.tag=o},THREE.SEA3D.prototype.readSkeletonLocal=function(n){var r=[],i,t;for(i in n.joint)t=n.joint[i],r[i]={name:t.name,pos:[t.x,t.y,t.z],rotq:[t.qx,t.qy,t.qz,t.qw],parent:t.parentIndex};n.tag=r},THREE.SEA3D.prototype.readJointObject=function(n){var t=n.target.tag,r=t.bones[n.joint],i=THREE.BoneObject.creat(t,r);i.name=n.name,this.joints=this.joints||[],this.joints.push(this.objects["jnt/"+n.name]=n.tag=i),this.addSceneObject(n)},THREE.SEA3D.prototype.getSkeletonAnimation=function(n,t){var s,c,r,f,i;if(n.tag)return n.tag;var e=[],o=n.frameRate/1e3,v=[1,1,1];for(s in n.sequence){var u=n.sequence[s],h=u.start,y=h+u.count,p=n.name+"/"+u.name;for(animation={name:p,repeat:u.repeat,fps:n.frameRate,JIT:0,length:o*(u.count-1),hierarchy:[]},c=n.pose[0].length,r=0;r<c;r++){var w=t.joint[r],l={parent:w.parentIndex,keys:[]},b=l.keys,a=0;for(f=h;f<y;f++)i=n.pose[f][r],b.push({time:a,pos:[i.x,i.y,i.z],rot:[i.qx,i.qy,i.qz,i.qw],scl:v}),a+=o;animation.hierarchy[r]=l}e.push(animation)}return n.tag=e},THREE.SEA3D.prototype.getMorpher=function(n,t){var u=[],i;for(i in n.node){var r=n.node[i],f=this.morphVectorToVector3(t.vertex,r.vertex),e=n.normal?this.morphVectorToVector3(t.normal,r.normal):[];u[r.name]=i,u[i]={name:r.name,vertices:f,normals:e}}return u},THREE.SEA3D.Event={PROGRESS:"progress",DOWNLOAD_PROGRESS:"download_progress",COMPLETE:"complete",OBJECT_COMPLETE:"object_complete",ERROR:"error"},THREE.SEA3D.prototype.onComplete=function(n){n.file=this.scope,n.type=THREE.SEA3D.Event.COMPLETE,n.file.dispatchEvent(n)},THREE.SEA3D.prototype.onProgress=function(n){n.file=this.scope,n.type=THREE.SEA3D.Event.PROGRESS,n.file.dispatchEvent(n)},THREE.SEA3D.prototype.onDownloadProgress=function(n){n.file=this.scope,n.type=THREE.SEA3D.Event.DOWNLOAD_PROGRESS,n.file.dispatchEvent(n)},THREE.SEA3D.prototype.onCompleteObject=function(n){n.file=this.scope,n.type=THREE.SEA3D.Event.OBJECT_COMPLETE,n.file.dispatchEvent(n)},THREE.SEA3D.prototype.onError=function(){args.file=this.scope,args.type=THREE.SEA3D.Event.ERROR,args.file.dispatchEvent(args)},THREE.SEA3D.prototype.load=function(n){this.file=new SEA3D.File,this.file.scope=this,this.file.onComplete=this.onComplete,this.file.onProgress=this.onProgress,this.file.onCompleteObject=this.onCompleteObject,this.file.onDownloadProgress=this.onDownloadProgress,this.file.onError=this.onError,this.file.typeRead[SEA3D.Geometry.prototype.type]=this.readGeometry,this.file.typeRead[SEA3D.Mesh.prototype.type]=this.readMesh,this.file.typeRead[SEA3D.Material.prototype.type]=this.readMaterial,this.file.typeRead[SEA3D.PointLight.prototype.type]=this.readPointLight,this.file.typeRead[SEA3D.DirectionalLight.prototype.type]=this.readDirectionalLight,this.file.typeRead[SEA3D.Camera.prototype.type]=this.readCamera,this.file.typeRead[SEA3D.Skeleton.prototype.type]=this.readSkeleton,this.file.typeRead[SEA3D.SkeletonLocal.prototype.type]=this.readSkeletonLocal,this.file.typeRead[SEA3D.JointObject.prototype.type]=this.readJointObject,this.file.typeRead[SEA3D.CubeMap.prototype.type]=this.readCubeMap,this.file.typeRead[SEA3D.Animation.prototype.type]=this.readAnimation,this.file.typeRead[SEA3D.JPEG.prototype.type]=this.readImage,this.file.typeRead[SEA3D.JPEG_XR.prototype.type]=this.readImage,this.file.typeRead[SEA3D.PNG.prototype.type]=this.readImage,this.file.typeRead[SEA3D.GIF.prototype.type]=this.readImage,this.file.load(n)};