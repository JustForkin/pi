<!DOCTYPE html>
<html lang="en">
<head>
<title>PNG to SCRIPT</title>
<meta charset="utf-8">
<style>
body {
    background-color:#010101;
    color: #fff;
    margin: 0px;
    overflow: hidden;
}
</style>
</head>

<body>
<script type="text/javascript">

var canvas = document.getElementById('myCanvas');
var context;
var imgData;

var img = new Image();
img.onload = function() {
	var c=document.createElement("canvas"), r='';
	var s = this.width;
	c.width = c.height = s;
	var ctx = c.getContext('2d');
	ctx.drawImage(this, 0, 0);
	var d = ctx.getImageData(0, 0, s, s).data;
	for(var i = 0, l=d.length; i < l; i+=4) {if(d[i]>0) r += String.fromCharCode(d[i]); }

	pushCode(r);
};
img.src = "img/oimo_three.png";

var pushCode = function (r){
	var head = document.getElementsByTagName('head')[0];
	nscript = document.createElement("script");
	nscript.type = "text/javascript";
	nscript.name = "topScript";
	nscript.id = "topScript";
	nscript.charset = "utf-8";
	nscript.text = r;
	head.appendChild(nscript);
	test();
}

var camera, scene, renderer;
var mesh;

function test() {
	renderer = new THREE.WebGLRenderer({ antialias: false });
	renderer.setSize( window.innerWidth, window.innerHeight );
	document.body.appendChild( renderer.domElement );
	renderer.gammaInput = true;
	renderer.gammaOutput = true;
	renderer.setClearColor( 0x202020, 1 );

	//

	camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
	camera.position.z = 400;

	scene = new THREE.Scene();

	var ambientLight = new THREE.AmbientLight( 0x202020 );
	scene.add( ambientLight );

	var pointLight = new THREE.PointLight( 0xffffff, 1.5, 1000 );
	pointLight.color.setHSL( 0.05, 1, 0.95 );
	pointLight.position.set( 0, 0, 600 );
	scene.add( pointLight );

	var spotLight = new THREE.SpotLight( 0xffffff, 1.5 );
	spotLight.position.set( 0.05, 0.05, 1 );
	spotLight.color.setHSL( 0.6, 1, 0.95 );
	scene.add( spotLight );

	var directionalLight = new THREE.DirectionalLight( 0xffffff, 1.5 );
	directionalLight.position.set( 1, -0.5, 1 );
	directionalLight.color.setHSL( 0.6, 1, 0.95 );
	scene.add( directionalLight );
	directionalLight.position.multiplyScalar( 500 );

	var directionalLight2 = new THREE.DirectionalLight( 0xffffff, 1.2 );
	directionalLight2.position.set( 1, -0.5, -1 );
	directionalLight2.color.setHSL( 0.08, 1, 0.825 );
	scene.add( directionalLight2 );

	//var geometry = new THREE.CubeGeometry( 200, 200, 200 );
	var geometry = new THREE.SphereGeometry( 100, 60, 50 );

	var mapHeight = THREE.ImageUtils.loadTexture( 'img/oimo_three.png' );
	//mapHeight.anisotropy = 4;
	mapHeight.repeat.set( 0.998, 0.998 );
	mapHeight.offset.set( 0.001, 0.001 );
	mapHeight.format = THREE.RGBFormat;
	mapHeight.anisotropy = renderer.getMaxAnisotropy();

	var material = new THREE.MeshPhongMaterial( { bumpMap: mapHeight, bumpScale: 19, metal: true,  ambient: 0x202020, color: 0x404040, specular: 0x505050, shininess: 60 } );

	mesh = new THREE.Mesh( geometry, material );
	scene.add( mesh );

	//

	window.addEventListener( 'resize', onWindowResize, false );
	animate();

}

function onWindowResize() {

	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );

}

function animate() {

	requestAnimationFrame( animate );

	mesh.rotation.x += 0.005;
	mesh.rotation.y += 0.01;

	renderer.render( scene, camera );

}

</script>
</body>
</html>
